<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>+ILLuSio</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
<h1 class="logo">+ILLuSio</h1>
<button id="addPartBtn" class="add-part">ï¼‹ãƒ‘ãƒ¼ãƒ„è¿½åŠ </button>
</header>
<main class="main-area">
<div class="necklace-area">
<svg id="necklaceCanvas" width="320" height="320">
<circle cx="160" cy="160" r="130" stroke="#bfbfbf" stroke-width="2" fill="none" />
</svg>
</div>
</main>
<footer class="bottom-buttons">
<button id="saveBtn">ğŸ’ ã“ã®ãƒãƒƒã‚¯ãƒ¬ã‚¹ã‚’ä¿å­˜</button>
<button id="partsBtn">ğŸ’  ãƒ‘ãƒ¼ãƒ„ä¸€è¦§</button>
</footer>
<!-- ãƒ‘ãƒ¼ãƒ„ä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="partsModal" class="modal hidden">
<div class="modal-content">
<span id="closeParts">&times;</span>
<h2>ãƒ‘ãƒ¼ãƒ„ä¸€è¦§</h2>
<div class="parts-grid" id="partsGrid"></div>
</div>
</div>
<script>
   const partsBtn = document.getElementById("partsBtn");
   const modal = document.getElementById("partsModal");
   const closeBtn = document.getElementById("closeParts");
   const grid = document.getElementById("partsGrid");
   // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºåˆ‡æ›¿
   partsBtn.addEventListener("click", async () => {
     modal.classList.remove("hidden");
     await loadParts();
   });
   closeBtn.addEventListener("click", () => modal.classList.add("hidden"));
   // ãƒ‘ãƒ¼ãƒ„è¿½åŠ ãƒœã‚¿ãƒ³
   document.getElementById("addPartBtn").addEventListener("click", () => {
     window.location.href = "admin.html";
   });
   // âœ… ãƒ‘ãƒ¼ãƒ„ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€
   async function loadParts() {
     grid.innerHTML = "èª­ã¿è¾¼ã¿ä¸­â€¦";
     try {
       const res = await fetch("/photos");
       const photos = await res.json();
       if (!photos.length) {
         grid.innerHTML = "<p>ãƒ‘ãƒ¼ãƒ„ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
         return;
       }
       // 2åˆ—ã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆ
       grid.innerHTML = "";
       photos.forEach(p => {
         const div = document.createElement("div");
         div.className = "part-item";
         div.innerHTML = `
<img src="${p.listUrl}" alt="${p.color}" width="80" height="80" draggable="true">
<p>${p.color}</p>
         `;
         // ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒãƒƒã‚¯ãƒ¬ã‚¹ã‚¨ãƒªã‚¢ã«è¿½åŠ ï¼‰
         div.querySelector("img").addEventListener("dragstart", e => {
           e.dataTransfer.setData("part", JSON.stringify(p));
         });
         grid.appendChild(div);
       });
     } catch (err) {
       grid.innerHTML = `<p style="color:red;">ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${err.message}</p>`;
     }
   }
   // âœ… ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦é…ç½®
   const canvas = document.getElementById("necklaceCanvas");
   canvas.addEventListener("dragover", e => e.preventDefault());
   canvas.addEventListener("drop", e => {
     e.preventDefault();
     const data = JSON.parse(e.dataTransfer.getData("part"));
     const svg = e.target.closest("svg");
     const rect = svg.getBoundingClientRect();
     const x = e.clientX - rect.left;
     const y = e.clientY - rect.top;
     const img = document.createElementNS("http://www.w3.org/2000/svg", "image");
     img.setAttributeNS(null, "href", data.singleUrl);
     img.setAttributeNS(null, "x", x - 15);
     img.setAttributeNS(null, "y", y - 15);
     img.setAttributeNS(null, "width", 30);
     img.setAttributeNS(null, "height", 30);
     svg.appendChild(img);
   });
</script>
</body>
</html>
