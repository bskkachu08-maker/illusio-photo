<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>+ILLuSio</title>
<style>
 :root{
   --wire:#bfbfbf;
   --panel-bg:#fff;
 }
 body{
   margin:0; font-family:"Hiragino Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
   background:#f7f7f7; color:#111; height:100vh; display:flex; flex-direction:column; text-align:center;
 }
 header{ position:relative; padding:10px 0 0; }
 .logo{ font-weight:700; font-size:2rem; margin:.5rem 0 0; }
 .add-part{
   position:absolute; right:10px; top:10px; background:#111; color:#fff;
   border:0; border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:600;
 }
 .main-area{ flex:1; display:flex; align-items:center; justify-content:center; }
 svg{ display:block; }
 .bottom-buttons{ display:flex; gap:10px; justify-content:center; padding:12px 0 16px; }
 .btn{ background:#111; color:#fff; border:0; border-radius:10px; padding:10px 14px; cursor:pointer; }
 /* Êìç‰Ωú„Éê„ÉºÔºàÈÄèÊòéËÉåÊôØ„ÉªÈªí„Ç¢„Ç§„Ç≥„É≥Ôºâ */
 .edit-bar{
   position:fixed; right:16px; bottom:16px;
   display:none; flex-direction:column; gap:10px;
   background:rgba(255,255,255,0.8);
   color:#000; padding:10px 12px;
   border-radius:16px;
   backdrop-filter: blur(4px);
   z-index:100;
   box-shadow:0 4px 16px rgba(0,0,0,.15);
 }
 .edit-bar.show{ display:flex; animation:fadeIn .2s ease; }
 @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
 .edit-row{ display:flex; gap:8px; justify-content:center; }
 .ctrl{
   width:46px; height:46px;
   border-radius:12px; border:1px solid rgba(0,0,0,.2);
   background:transparent; color:#000;
   font-size:18px; font-weight:700; cursor:pointer;
   transition:transform .12s ease, background .12s ease;
 }
 .ctrl:hover{ transform:scale(1.06); background:rgba(0,0,0,.05); }
 .close-edit{
   align-self:flex-end;
   font-size:20px; cursor:pointer; padding:2px 6px; margin-bottom:-4px;
   border:none; background:transparent; color:#000;
 }
 @media (max-width:420px){
   #canvas{ width:300px; height:300px; }
   #wire{ cx:150px; cy:150px; r:125px; }
 }
</style>
</head>
<body>
<header>
<h1 class="logo">+ILLuSio</h1>
<button id="addPartBtn" class="add-part">Ôºã„Éë„Éº„ÉÑËøΩÂä†</button>
</header>
<main class="main-area">
<svg id="canvas" width="340" height="340">
<circle id="wire" cx="170" cy="170" r="140" stroke="var(--wire)" stroke-width="2" fill="none"/>
</svg>
</main>
<footer class="bottom-buttons">
<button id="saveBtn"  class="btn">üíé ‰øùÂ≠ò</button>
<button id="partsBtn" class="btn">üí† „Éë„Éº„ÉÑ‰∏ÄË¶ß</button>
</footer>
<!-- Êìç‰Ωú„Éê„Éº -->
<div id="editBar" class="edit-bar">
<button id="closeEdit" class="close-edit">‚úï</button>
<div class="edit-row">
<button id="rotateL" class="ctrl" title="Â∑¶ÂõûËª¢">‚Ü∫</button>
<button id="rotateR" class="ctrl" title="Âè≥ÂõûËª¢">‚Üª</button>
</div>
<div class="edit-row">
<button id="bigger"  class="ctrl" title="Êã°Â§ß">Ôºã</button>
<button id="smaller" class="ctrl" title="Á∏ÆÂ∞è">Ôºç</button>
</div>
<button id="delete" class="ctrl" title="ÂâäÈô§">üóë</button>
</div>
<script>
 const svg = document.getElementById("canvas");
 const wire = document.getElementById("wire");
 const editBar = document.getElementById("editBar");
 const btnRotL = document.getElementById("rotateL");
 const btnRotR = document.getElementById("rotateR");
 const btnBig  = document.getElementById("bigger");
 const btnSmall= document.getElementById("smaller");
 const btnDel  = document.getElementById("delete");
 const btnClose= document.getElementById("closeEdit");
 let beads = [];
 let selected = null;
 let rotationDeg = 0;
 let lastActionAt = 0;
 const ZOOM_SCALE = 1.5;
 const ROT_STEP = 30; // ‚Üê 30Â∫¶„Å´Â§âÊõ¥
 function canAct(interval=120){
   const now = Date.now();
   if(now - lastActionAt < interval) return false;
   lastActionAt = now;
   return true;
 }
 function getCircle(){
   return {
     cx: parseFloat(wire.getAttribute("cx")),
     cy: parseFloat(wire.getAttribute("cy")),
     r:  parseFloat(wire.getAttribute("r")),
   };
 }
 function normalize(a){
   while(a <= -Math.PI) a += 2*Math.PI;
   while(a >   Math.PI) a -= 2*Math.PI;
   return a;
 }
 function angleAtPoint(x,y){
   const {cx,cy} = getCircle();
   return Math.atan2(y - cy, x - cx);
 }
 function posFromAngle(angle,w=35,h=35){
   const {cx,cy,r} = getCircle();
   const px = cx + r * Math.cos(angle);
   const py = cy + r * Math.sin(angle);
   return { x: px - w/2, y: py - h/2 };
 }
 function centerOf(el){
   const x = parseFloat(el.getAttribute("x"));
   const y = parseFloat(el.getAttribute("y"));
   const w = parseFloat(el.getAttribute("width"));
   const h = parseFloat(el.getAttribute("height"));
   return { x, y, w, h, cx: x + w/2, cy: y + h/2 };
 }
 function applyCenterRotate(el, deg){
   el.dataset.rotate = String(deg);
   const c = centerOf(el);
   el.setAttribute("transform", `rotate(${deg}, ${c.cx}, ${c.cy})`);
 }
 function addBead(url, angle){
   const el = document.createElementNS("http://www.w3.org/2000/svg","image");
   el.setAttributeNS(null,"href", url);
   el.setAttributeNS(null,"width", 35);
   el.setAttributeNS(null,"height",35);
   el.dataset.rotate = "0";
   svg.appendChild(el);
   const bead = { el, angle: normalize(angle) };
   beads.push(bead);
   updateBeadPosition(bead);
   let dragging = false;
   el.addEventListener("pointerdown", e=>{
     e.preventDefault(); dragging = true;
     selectBead(el);
     el.setPointerCapture(e.pointerId);
   });
   el.addEventListener("pointermove", e=>{
     if(!dragging) return;
     const rect = svg.getBoundingClientRect();
     const mx = e.clientX - rect.left;
     const my = e.clientY - rect.top;
     bead.angle = normalize(angleAtPoint(mx,my));
     updateBeadPosition(bead);
   });
   el.addEventListener("pointerup", e=>{
     dragging = false;
     el.releasePointerCapture(e.pointerId);
   });
   el.addEventListener("click", ()=> selectBead(el));
 }
 function updateBeadPosition(b){
   const el = b.el;
   const w = parseFloat(el.getAttribute("width"));
   const h = parseFloat(el.getAttribute("height"));
   const p = posFromAngle(b.angle,w,h);
   el.setAttribute("x",p.x);
   el.setAttribute("y",p.y);
   applyCenterRotate(el, parseFloat(el.dataset.rotate||"0"));
 }
 function selectBead(el){
   selected = beads.find(b => b.el === el) || null;
   if(selected){
     rotationDeg = parseFloat(el.dataset.rotate || "0");
     editBar.classList.add("show");
   }
 }
 // Á©∫ÁôΩ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
 svg.addEventListener("pointerdown", e=>{
   if(e.target.tagName.toLowerCase()!=="image"){
     selected=null; editBar.classList.remove("show");
   }
 });
 btnClose.addEventListener("click", ()=> editBar.classList.remove("show"));
 // ÂõûËª¢
 btnRotL.addEventListener("click", ()=>{
   if(!selected || !canAct()) return;
   rotationDeg -= ROT_STEP;
   applyCenterRotate(selected.el, rotationDeg);
 });
 btnRotR.addEventListener("click", ()=>{
   if(!selected || !canAct()) return;
   rotationDeg += ROT_STEP;
   applyCenterRotate(selected.el, rotationDeg);
 });
 // „Çµ„Ç§„Ç∫Â§âÊõ¥
 function resizeSelected(scale){
   const el = selected.el;
   const c  = centerOf(el);
   const nw = Math.min(Math.max(c.w*scale, 16), 240);
   const nh = Math.min(Math.max(c.h*scale, 16), 240);
   el.setAttribute("x", c.cx - nw/2);
   el.setAttribute("y", c.cy - nh/2);
   el.setAttribute("width", nw);
   el.setAttribute("height",nh);
   applyCenterRotate(el, parseFloat(el.dataset.rotate||"0"));
 }
 btnBig.addEventListener("click", ()=>{ if(!selected||!canAct())return; resizeSelected(ZOOM_SCALE); });
 btnSmall.addEventListener("click", ()=>{ if(!selected||!canAct())return; resizeSelected(1/ZOOM_SCALE); });
 btnDel.addEventListener("click", ()=>{
   if(!selected) return;
   selected.el.remove();
   beads = beads.filter(b => b !== selected);
   selected=null;
   editBar.classList.remove("show");
 });
<div id="necklaceArea"></div>
<!-- JS„ÅØnewpublic„Åã„ÇâÊèê‰æõ„Åï„Çå„Çã -->
<script defer src="/script.js"></script>
</body>
</html>
